//=========================================================================
//  @package      Wicle
//  @module       ui/components/search
//  @description  Search Form
//
//  @usage
//    <form class="w-search" onclick="this.children[0].focus()">
//      <input type="search" ...>
//    </form>
//
//  @notes
//    It's recommended to have onclick handler to set focus on input field
//      ex) onclick="this.getElementsByTagName('input')[0].focus()"
//      ex) onclick="this.children[0].focus()"
//
//  @classes
//    .w-search
//
//  @options
//    .wo-compact:     reduce line height
//    .wo-iconize:     show search icon only
//    .wo-small:       font size set to 0.9rem
//    .wo-large:       font size set to 1.5rem
//    .wo-xlarge:      font size set to 2rem
//    .wo-xxlarge:     font size set to 3rem
//
//=========================================================================
@import "../../../wdk/wdk";

//-----------------------------------------------
//  data
//-----------------------------------------------
$w-search-generate-classes:     true !default;   // enable class generation
$w-conf-search: ();
$w-search-icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 980 980"><path fill="#000000" d="m29.1 810.2c-18 18-29.1 42.9-29.1 70.3 0 54.9 44.5 99.5 99.4 99.5 27.5 0 52.3-11.1 70.3-29.1l210.7-210.7c59.2 35 128 55.4 201.8 55.4 219.7 0 397.8-178.1 397.8-397.8s-178.1-397.8-397.8-397.8-397.8 178.1-397.8 397.8c0 73.7 20.4 142.6 55.4 201.8zm553.1-710.8c164.8 0 298.4 133.6 298.4 298.4s-133.6 298.3-298.3 298.3-298.3-133.6-298.3-298.3c-0.1-164.8 133.4-298.4 298.2-298.4z"/></svg>';

//--- core
$w-conf-search: scv($w-conf-search, 'fg', gray(60%), true);
$w-conf-search: scv($w-conf-search, 'bg', white, true);
$w-conf-search: scv($w-conf-search, 'font', normal 1rem $w-font-sans, true);
$w-conf-search: scv($w-conf-search, 'line-height', 2em, true);
$w-conf-search: scv($w-conf-search, 'max-width', 12em, true);
$w-conf-search: scv($w-conf-search, 'radius', $w-border-radius, true);

//--- search icon
$w-conf-search: scv($w-conf-search, 'icon/code', '\1F50E', true);  // possible uncodes: '1F50D', '1F50E'
$w-conf-search: scv($w-conf-search, 'icon/margin', 0.5rem, true);
$w-conf-search: scv($w-conf-search, 'icon/fg', gray(50%), true);

//--- search text
$w-conf-search: scv($w-conf-search, 'text/fg', $w-color-text-black, true); // search icon
$w-conf-search: scv($w-conf-search, 'text/active/fg', tint($w-color-primary, 35%), true); // search icon

//--- etc
$w-conf-search: scv($w-conf-search, 'shadow/fg', tint($w-color-primary, 35%), true);
$w-conf-search: scv($w-conf-search, 'shadow/size', 3px, true);
$w-conf-search: scv($w-conf-search, 'transition', (all 0.2s ease-in-out), true); // search icon



//=== data interface
@mixin scv-search($path, $value, $default:false) {
  $w-conf-search: scv($w-conf-search, $path, $value, $default) !global;
}

@mixin scv-search-merge($conf) {
  $w-conf-search: map-merge($w-conf-search, $conf) !global;
}

@function gcv-search($path) {
  @return gcv($w-conf-search, $path);
}


//-----------------------------------------------
//  mixin's
//-----------------------------------------------
@mixin w-search-core {
  $font:          gcv-search(font); // to-string(map-values(gcv($conf, 'font')), ' ');
  $icon-margin:   gcv-search(icon/margin);

  display: inline-block;
  //white-space: nowrap;
  //display: flex;
  //flex-flow: row nowrap;
  position: relative;
  font: gcv-search(font);
  margin: 0;
  padding: 0;

  // search icon
  &:after {
    content: '';
    width: 100%;
    height: 50%;
    background: svg-url($w-search-icon, gcv-search('icon/fg')) no-repeat;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    left: $icon-margin;
  }

  // input box
  &>input[type=search] {
    font: $font;
    box-sizing: border-box;
    margin: 0;
    width: gcv-search(max-width);
    padding-left: $icon-margin*2 + 1rem;  // make space for search icon
    vertical-align: middle;
    line-height: gcv-search(line-height);
    border-radius: gcv-search(radius);
    border: 1px solid gcv-search(fg);
    transition: gcv-search(transition);

    // remove search cancel button
    &::-webkit-search-cancel-button,
    &::-webkit-search-decoration { -webkit-appearance: none; }
    &::-ms-clear { display: none; }   // IE 10

    // highlight on focus
    &:focus {
      width: gcv-search(max-width);
      border: 1px solid gcv-search('text/active/fg');
      outline: 0;
      box-shadow: 0 0 gcv-search(shadow/size) gcv-search(shadow/fg); // rgba(107,21,161,0.3);
    }
  }
}

@mixin w-search-styles {
  &>input[type=search] {
    background: gcv-search(bg);
  }
}

@mixin w-search-options {
  &.wo-minify {
    &>input[type=search] {
      width: gcv-search(icon/margin) * 4; // left/right margins are 50% of icon. So total width is 4 times of the margin
      &:focus {
        width: gcv-search(max-width);
      }
    }
  }
  &.wo-iconize {
    &>input[type=search] {
      border-style: hidden;
      width: 1rem;
      &:focus {
        border-style: solid;
        width: gcv-search(max-width);
      }
    }
  }
  &.wo-compact {
    &>input[type=search] {
      line-height: 1.5rem;
      padding-left: 1.5rem;
    }
  }
  &.wo-small {
    &>input[type=search] {
      font-size: 0.9rem;
      padding-left: 1.8rem;
    }
  }
  &.wo-large {
    &:after {
      left: gcv-search(icon/margin) * 2;
    }
    &>input[type=search] {
      font-size: 1.3rem;
      padding-left: 3rem;
    }
  }
  &.wo-xlarge {
    &:after {
      left: gcv-search(icon/margin) * 2;
    }
    &>input[type=search] {
      font-size: 2rem;
      padding-left: 3.75rem;
    }
  }
  &.wo-xxlarge {
    &:after {
      left: gcv-search(icon/margin) * 3;
    }
    &>input[type=search] {
      font-size: 3rem;
      padding-left: 5.5rem;
    }
  }
}

//-----------------------------------------------
// mixin's for classes generations
//-----------------------------------------------
@if $w-wicle-mode != 'scss' and $w-search-generate-classes {
  .w-search {
    @include w-search-core;
    @include w-search-styles;
    @include w-search-options;
  }
}
@if mixin-exists(w-hook-search) { @include w-hook-search(); }